module.exports=[99174,a=>{"use strict";var b=a.i(37936),c=a.i(89227),d=a.i(18558);async function e({page:a=1,limit:b=15,search:d="",status:e="all",type:f="all"}){let g=await (0,c.getSupabaseServerClient)(),h=(a-1)*b,i=g.from("reports").select("*",{count:"exact"});d&&(i=i.or(`title.ilike.%${d}%,description.ilike.%${d}%`)),e&&"all"!==e&&(i=i.ilike("status",e)),f&&"all"!==f&&(i=i.ilike("report_type",f));let{data:j,count:k,error:l}=await i.order("created_at",{ascending:!1}).range(h,h+b-1);if(l)return console.error("Error fetching reports:",l),{data:[],totalCount:0,totalPages:0,stats:{total:0,pending:0,inProgress:0,resolved:0}};let m=[...new Set([...new Set((j??[]).map(a=>a.reporter_id).filter(Boolean)),...new Set((j??[]).map(a=>a.reported_user_id).filter(Boolean))])],n={};if(m.length>0){let{data:a}=await g.from("profiles").select("id, username, email, fullname, avatar_url").in("id",m);a&&(n=a.reduce((a,b)=>(a[b.id]=b,a),{}))}let{data:o}=await g.from("reports").select("status"),p={total:o?.length??0,pending:o?.filter(a=>a.status?.toLowerCase()==="pending").length??0,inProgress:o?.filter(a=>a.status?.toLowerCase()==="in progress").length??0,resolved:o?.filter(a=>a.status?.toLowerCase()==="resolved").length??0};return{data:(j??[]).map(a=>({...a,reporter:a.reporter_id&&n[a.reporter_id]||null,reported_user:a.reported_user_id&&n[a.reported_user_id]||null})),totalCount:k??0,totalPages:Math.ceil((k??0)/b),stats:p}}async function f(a,b){let e=await (0,c.getSupabaseServerClient)(),{error:f}=await e.from("reports").update(b).eq("id",a);return f?(console.error("Error updating report:",f),{error:f.message}):((0,d.revalidatePath)("/reports"),{error:null})}async function g(a){let b=await (0,c.getSupabaseServerClient)(),{error:e}=await b.from("reports").delete().eq("id",a);return e?(console.error("Error deleting report:",e),{error:e.message}):((0,d.revalidatePath)("/reports"),{error:null})}async function h(a){let b=await (0,c.getSupabaseServerClient)(),{data:d,error:e}=await b.from("reports").select("*").eq("id",a).single();if(e)return console.error("Error fetching report:",e),{data:null,error:e.message};let f=[d.reporter_id,d.reported_user_id].filter(Boolean),g={};if(f.length>0){let{data:a}=await b.from("profiles").select("id, username, email, fullname, avatar_url").in("id",f);a&&(g=a.reduce((a,b)=>(a[b.id]=b,a),{}))}return{data:{...d,messages:d.messages||[],reporter:d.reporter_id&&g[d.reporter_id]||null,reported_user:d.reported_user_id&&g[d.reported_user_id]||null},error:null}}async function i(a,b,e="admin"){let f=await (0,c.getSupabaseServerClient)(),{data:g,error:h}=await f.from("reports").select("messages").eq("id",a).single();if(h)return console.error("Error fetching report messages:",h),{error:h.message};let j=g?.messages||[],k={id:crypto.randomUUID(),sender_id:"admin",sender_type:e,content:b,created_at:new Date().toISOString()},l=[...j,k],{error:m}=await f.from("reports").update({messages:l,updated_at:new Date().toISOString()}).eq("id",a);return m?(console.error("Error sending message:",m),{error:m.message}):((0,d.revalidatePath)(`/reports/${a}`),{error:null,message:k})}async function j(a,b,e){let f=await (0,c.getSupabaseServerClient)();if("admin"!==e)return{error:"You can only delete your own messages"};let{data:g,error:h}=await f.from("reports").select("messages").eq("id",a).single();if(h)return console.error("Error fetching report messages:",h),{error:h.message};let i=g?.messages||[],j=i.find(a=>a.id===b);if(!j||"admin"!==j.sender_type)return{error:"You can only delete your own messages"};let k=i.filter(a=>a.id!==b),{error:l}=await f.from("reports").update({messages:k,updated_at:new Date().toISOString()}).eq("id",a);return l?(console.error("Error deleting message:",l),{error:l.message}):((0,d.revalidatePath)(`/reports/${a}`),{error:null})}(0,a.i(13095).ensureServerEntryExports)([e,f,g,h,i,j]),(0,b.registerServerReference)(e,"408d466254296b7f20cb3566814d43db3b327f5642",null),(0,b.registerServerReference)(f,"605119fd3bb11cba9580e24bcd1ac8c5475ab8e7b8",null),(0,b.registerServerReference)(g,"4078aa72216dd8618e19b64ad67dd64058f296d8fe",null),(0,b.registerServerReference)(h,"40a00cc82d761c21ff51c6072dd709e0ba4d7fd6b2",null),(0,b.registerServerReference)(i,"705e86f5161c577390255ba4fb253566a9537032be",null),(0,b.registerServerReference)(j,"709691c9108acacaf3b5a9eb4c7eae85fb68c782ae",null),a.s(["deleteMessageAction",()=>j,"deleteReportAction",()=>g,"fetchReportById",()=>h,"fetchReports",()=>e,"sendMessageAction",()=>i,"updateReportAction",()=>f])},3918,a=>{"use strict";var b=a.i(51203),c=a.i(99174);a.s([],35549),a.i(35549),a.s(["0036e64456fb2be9f284aa63a8876a0297f090e2e1",()=>b.logout,"40a00cc82d761c21ff51c6072dd709e0ba4d7fd6b2",()=>c.fetchReportById,"705e86f5161c577390255ba4fb253566a9537032be",()=>c.sendMessageAction,"709691c9108acacaf3b5a9eb4c7eae85fb68c782ae",()=>c.deleteMessageAction],3918)}];

//# sourceMappingURL=_0f174080._.js.map