module.exports=[27837,a=>{"use strict";var b=a.i(93662);function c(){return(0,b.createClient)("https://humhaknetazvqkovlxdn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1bWhha25ldGF6dnFrb3ZseGRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxOTY0ODUsImV4cCI6MjA3NDc3MjQ4NX0.LU9j-zyUOihFE-MAgXY9-cOBPiVJDGFArH5sLpmOTxw",{auth:{autoRefreshToken:!1,persistSession:!1}})}a.s(["getSupabaseAdminClient",()=>c])},61100,a=>{"use strict";var b=a.i(37936),c=a.i(89227),d=a.i(27837),e=a.i(18558);async function f(a){let b=await (0,c.getSupabaseServerClient)(),{data:d,error:e}=await b.from("profiles").select("*").eq("id",a).single();if(e)return console.error("Error fetching profile:",e),{data:null,error:e.message};let f=d.following_count??d.followings_count??0,g=d.followers_count??d.follower_count??0,h=d.friends_count??d.friend_count??0;if(0===f&&0===g){let{count:c,error:d}=await b.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",a);d||null===c||(f=c);let{count:e,error:h}=await b.from("follows").select("*",{count:"exact",head:!0}).eq("following_id",a);h||null===e||(g=e)}if(0===h){let{count:c,error:d}=await b.from("friendships").select("*",{count:"exact",head:!0}).or(`user_id.eq.${a},friend_id.eq.${a}`).eq("status","accepted");d||null===c||(h=c)}let i=null,j=null,k=null;if(d.country_id){let{data:a}=await b.from("countries").select("id, name, latitude, longitude").eq("id",d.country_id).single();i=a}if(d.state_id){let{data:a}=await b.from("states").select("id, name, latitude, longitude").eq("id",d.state_id).single();j=a}if(d.city_id){let{data:a}=await b.from("cities").select("id, name, latitude, longitude").eq("id",d.city_id).single();k=a}return{data:{...d,following_count:f,followers_count:g,friends_count:h,country:i,state:j,city:k},error:null}}async function g(a){let b=await (0,c.getSupabaseServerClient)(),{data:d,error:e}=await b.from("game_sessions").select("quiz_id, participants");if(e)return console.error("Error fetching game sessions:",e),{data:[],error:e.message};let f={};for(let b of d??[]){let c=b.participants;if(c&&Array.isArray(c)){let d=c.find(b=>b.user_id===a);d&&(f[b.quiz_id]||(f[b.quiz_id]={count:0,totalScore:0}),f[b.quiz_id].count+=1,f[b.quiz_id].totalScore+=d.score??0)}}let g=Object.entries(f).sort((a,b)=>b[1].count-a[1].count).slice(0,10).map(([a])=>a);if(0===g.length)return{data:[],error:null};let{data:h,error:i}=await b.from("quizzes").select("id, title").in("id",g);return i?(console.error("Error fetching quizzes:",i),{data:[],error:i.message}):{data:(h??[]).map(a=>{let b=f[a.id]||{count:0,totalScore:0};return{id:a.id,title:a.title,play_count:b.count,avg_score:b.count>0?Math.round(b.totalScore/b.count):0}}).sort((a,b)=>b.play_count-a.play_count),error:null}}async function h(a){let b=await (0,c.getSupabaseServerClient)(),{data:d,error:e}=await b.from("quizzes").select("id, title, category, questions, created_at").eq("creator_id",a).is("deleted_at",null).order("created_at",{ascending:!1}).limit(10);return e?(console.error("Error fetching created quizzes:",e),{data:[],error:e.message}):{data:(d??[]).map(a=>({id:a.id,title:a.title,category:a.category,question_count:Array.isArray(a.questions)?a.questions.length:0,created_at:a.created_at})),error:null}}async function i({page:a=1,limit:b=15,search:c="",role:e="all",status:f="all"}){let g=(0,d.getSupabaseAdminClient)(),h=(a-1)*b,i=g.from("profiles").select("*, state:states(name), city:cities(name)",{count:"exact"}).is("deleted_at",null);c&&(i=i.or(`username.ilike.%${c}%,email.ilike.%${c}%,fullname.ilike.%${c}%`)),e&&"all"!==e&&(i=i.ilike("role",e)),f&&"all"!==f&&("blocked"===f?i=i.eq("is_blocked",!0):"active"===f&&(i=i.or("is_blocked.is.null,is_blocked.eq.false")));let{data:j,count:k,error:l}=await i.order("last_active",{ascending:!1,nullsFirst:!1}).range(h,h+b-1);return l?(console.error("Error fetching profiles:",l),{data:[],totalCount:0,totalPages:0}):{data:j??[],totalCount:k??0,totalPages:Math.ceil((k??0)/b)}}async function j(a,b){let c=(0,d.getSupabaseAdminClient)(),{error:f}=await c.from("profiles").update(b).eq("id",a);return f?(console.error("Error updating profile:",f),{error:f.message}):((0,e.revalidatePath)("/users"),{error:null})}async function k(a){let b=(0,d.getSupabaseAdminClient)(),{error:c}=await b.from("profiles").update({deleted_at:new Date().toISOString()}).eq("id",a);return c?(console.error("Error deleting profile:",c),{error:c.message}):((0,e.revalidatePath)("/users"),(0,e.revalidatePath)("/trash-bin"),{error:null})}(0,a.i(13095).ensureServerEntryExports)([f,g,h,i,j,k]),(0,b.registerServerReference)(f,"4014172907f628299944a4ab6f46399e59b565df69",null),(0,b.registerServerReference)(g,"403bce59f4e139321b5f7fc31182adbc446af90d67",null),(0,b.registerServerReference)(h,"40627fbafb57187a3b46613f78a336295f04a4c1dd",null),(0,b.registerServerReference)(i,"401b46a54cf9aacb6116e51f34e82a1b8ffbf0da7b",null),(0,b.registerServerReference)(j,"60a15162366377943a3e23738e78de1e1e09a224da",null),(0,b.registerServerReference)(k,"409eb8c54c498120c30cb6b42f4cedc11e98b7d901",null),a.s(["deleteProfileAction",()=>k,"fetchCreatedQuizzes",()=>h,"fetchProfileById",()=>f,"fetchProfiles",()=>i,"fetchUserQuizzes",()=>g,"updateProfileAction",()=>j])},40440,a=>{"use strict";var b=a.i(51203),c=a.i(61100);a.s([],28853),a.i(28853),a.s(["0036e64456fb2be9f284aa63a8876a0297f090e2e1",()=>b.logout,"4014172907f628299944a4ab6f46399e59b565df69",()=>c.fetchProfileById,"401b46a54cf9aacb6116e51f34e82a1b8ffbf0da7b",()=>c.fetchProfiles,"403bce59f4e139321b5f7fc31182adbc446af90d67",()=>c.fetchUserQuizzes,"40627fbafb57187a3b46613f78a336295f04a4c1dd",()=>c.fetchCreatedQuizzes,"409eb8c54c498120c30cb6b42f4cedc11e98b7d901",()=>c.deleteProfileAction,"60a15162366377943a3e23738e78de1e1e09a224da",()=>c.updateProfileAction],40440)}];

//# sourceMappingURL=_ac48a269._.js.map